const {
  env: { DEPLOY_ID },
} = require('process')

const { getTypeInfo } = require('./type')

// Handle top-level build errors.
// Logging is done separately.
const handleBuildError = async function(error, api) {
  const { shouldCancel } = getTypeInfo(error)
  await cancelBuild(shouldCancel, api)
}

// Cancel builds, for example when a plugin uses `utils.build.cancel()`
<<<<<<< HEAD
const cancelBuild = async function(shouldCancel, api) {
  if (!shouldCancel || api === undefined || !DEPLOY_ID) {
    return
  }

  await api.cancelSiteDeploy({ deploy_id: DEPLOY_ID })
=======
const cancelBuild = async function(shouldCancel, api, { id: siteId }) {
  console.log({ shouldCancel, api: typeof api, siteId, DEPLOY_ID })
  if (!shouldCancel || api === undefined || !siteId || !DEPLOY_ID) {
    return
  }

  console.log('Start')
  const response = await api.cancelSiteDeploy({ site_id: siteId, deploy_id: DEPLOY_ID })
  console.log(response)
  console.log('End')
>>>>>>> Add debugging statements
}

module.exports = { handleBuildError }
